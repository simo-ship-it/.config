"use strict";var P=Object.create;var g=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var N=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Y=(o,e)=>{for(var t in e)g(o,t,{get:e[t],enumerable:!0})},A=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of O(e))!J.call(o,s)&&s!==t&&g(o,s,{get:()=>e[s],enumerable:!(i=$(e,s))||i.enumerable});return o};var _=(o,e,t)=>(t=o!=null?P(X(o)):{},A(e||!o||!o.__esModule?g(t,"default",{value:o,enumerable:!0}):t,o)),K=o=>A(g({},"__esModule",{value:!0}),o);var E=N(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});var S=require("react"),U=function(){};function D(o,e,t){var i=S.useRef(U);S.useEffect(function(){i.current=o}),S.useEffect(function(){!t||e===null||e===!1||i.current()},[t]),S.useEffect(function(){if(!(e===null||e===!1)){var s=function(){return i.current()},c=setInterval(s,e);return function(){return clearInterval(c)}}},[e])}v.default=D;v.useInterval=D});var Q={};Y(Q,{default:()=>H});module.exports=K(Q);var n=require("@raycast/api"),h=require("react"),I=_(E());function b(o,e){return Math.floor(Math.random()*(e-o)+o)}var T="O",C="\u2589",m=" ";function G(o,e){return{x:o.x+e.x,y:o.y+e.y}}function q(o,e){let t=0,i=0;switch(o){case f.up:i=-1;break;case f.down:i=1;break;case f.left:t=-1;break;case f.right:t=1;break}return{x:t,y:i}}function B(o,e){return G(q(o,e),e)}var f=(s=>(s[s.up=0]="up",s[s.down=1]="down",s[s.left=2]="left",s[s.right=3]="right",s))(f||{}),w=class{constructor(e){this.bodyLength=3;this.head=e,this.body=[]}move(e,t){let i=t.field,s=G(this.head,e),c=i.getValue(s);if(c===T)this.bodyLength+=1,t.increaseFood(),t.spawnFood();else if(c===void 0||c===C){t.setMessage("Game Over \u{1F61D}");return}i.setValue(s,C);let d=u=>{for(let r of this.body)i.setValue(r,u)};d(m),this.body=[this.head].concat(this.body),this.body=this.body.slice(0,this.bodyLength),d(C),this.head=s}},R=class{constructor(){this.width=104;this.height=18;this.data=[];this.clearField()}setSize(e){e==="medium"?(this.width=104,this.height=18):(this.width=90,this.height=14)}clearField(){let e=[];for(let t=0;t<this.height*this.width;t++)e.push(m);this.data=e}isValidCoord(e){return!(e.x<0||e.y<0||e.x>=this.width||e.y>this.height)}coordToIndex(e){return this.width*e.y+e.x}getValue(e){if(this.isValidCoord(e)){let t=this.coordToIndex(e);return this.data[t]}else return}setValue(e,t){if(this.isValidCoord(e)){let i=this.coordToIndex(e);this.data[i]=t}}isFieldFull(){for(let e of this.data)if(e===m)return!1;return!0}getRandomFreeCoord(){let e=[];for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let s={x:i,y:t};this.getValue(s)===m&&e.push(s)}if(e.length>0){let t=b(0,e.length);return e[t]}}toString(){let e=`
`;for(let t=-1;t<=this.height;t++){for(let i=-1;i<=this.width;i++){let s=m;t==-1||t===this.height||i==-1||i===this.width?i===-1&&t===-1?s="\u2554":i===this.width&&t===-1?s="\u2557":i===-1&&t===this.height?s="\u255A":i===this.width&&t===this.height?s="\u255D":t===-1||t===this.height?s="\u2550":i==-1||i===this.width?s="\u2551":s=" ":(s=this.getValue({x:i,y:t}),s||console.log(`value of ${i}, ${t} is undefined`)),e+=s}e+=`
`}return e}},y=class{constructor(e,t,i,s){this.field=new R;this.snakeDirection=3;this.foodCount=0;this.speedMs=1e3;this.minSpeedMs=150;this.maxSpeedMs=30;this.speed=1;this.setField=e,this.setError=t,this.setScore=i,this.setMessage=s,this.snake=new w({x:2,y:2})}flush(){this.setField(this.field.toString())}getSpeedMs(){let e=this.snakeDirection;return e===0||e===1?Math.floor(this.speedMs+this.speedMs*.2):this.speedMs}start(e){this.field.setSize(e),this.field.clearField(),this.setError(void 0),this.snake=new w({x:b(20,80),y:b(5,this.field.height-5)}),this.foodCount=0,this.speed=1,this.speedMs=this.minSpeedMs,this.setScore({food:this.foodCount,speed:1}),this.spawnFood()}move(e){let t=B(e,this.snake.head),i=this.field.getValue(t);!(i&&i===C)&&(this.snakeDirection=e)}increaseFood(){this.foodCount+=1;let e=this.speedMs-5,t=!0;e<this.maxSpeedMs&&(e=this.maxSpeedMs,t=!1),this.speedMs=e,t&&(this.speed+=1),this.setScore({food:this.foodCount,speed:this.speed}),this.field.isFieldFull()&&this.setMessage("You win \u{1F600}")}spawnFood(){let e=this.field.getRandomFreeCoord();e&&this.field.setValue(e,T)}draw(){try{let e=this.snakeDirection,t=0,i=0;switch(e){case 0:i=-1;break;case 1:i=1;break;case 2:t=-1;break;case 3:t=1;break}this.snake.move({x:t,y:i},this),this.setField(this.field.toString())}catch(e){this.setError(e.message)}}stop(){this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)}};var a=require("react/jsx-runtime");function x(o){return(0,a.jsx)(n.Action,{title:o.title,shortcut:o.shortcut,icon:o.icon,onAction:()=>o.game.move(o.move)})}function V(){let[o,e]=(0,h.useState)(),[t,i]=(0,h.useState)(!1),s=n.environment.textSize,{field:c,game:d,score:u,message:r,restart:M}=j(e,s),k=o||r?null:d.getSpeedMs();(0,I.default)(()=>{s!==void 0&&d.draw()},t?null:k);let z="```"+c+"```";o&&(0,n.showToast)({style:n.Toast.Style.Failure,title:"Error",message:o});let F=()=>u?`Foods: ${u.food}, Speed: ${u.speed}`:"",p=[];if(r){let l=F();p.push(`## ${r}`+(l?"          "+l:""))}else if(u){let l=F();process.env.NODE_ENV==="development"&&(l+=` (${k||"?"}ms)`),p.push(l)}p.push(z);let L=s!==void 0?p.join(`

`):"---";return(0,a.jsx)(n.Detail,{isLoading:s===void 0,markdown:L,actions:(0,a.jsxs)(n.ActionPanel,{children:[r===void 0&&(0,a.jsx)(n.Action,{title:t?"Continue":"Pause",icon:{source:t?"play.png":"pause.png",tintColor:n.Color.PrimaryText},onAction:()=>i(!t)}),(0,a.jsx)(n.Action,{title:"Restart Game",icon:{source:n.Icon.ArrowClockwise},onAction:()=>M()}),(0,a.jsx)(n.Action.CopyToClipboard,{title:"Copy Score to Clipboard",content:u?.food||0}),(0,a.jsx)(x,{game:d,title:"Up",icon:{source:"\u2B06\uFE0F"},move:0,shortcut:{modifiers:["cmd","shift"],key:"arrowUp"}}),(0,a.jsx)(x,{game:d,title:"Down",icon:{source:"\u2B07\uFE0F"},move:1,shortcut:{modifiers:["cmd","shift"],key:"arrowDown"}}),(0,a.jsx)(x,{game:d,title:"Left",icon:{source:"\u2B05\uFE0F"},move:2,shortcut:{modifiers:["cmd","shift"],key:"arrowLeft"}}),(0,a.jsx)(x,{game:d,title:"Right",icon:{source:"\u27A1\uFE0F"},move:3,shortcut:{modifiers:["cmd","shift"],key:"arrowRight"}})]})})}function j(o,e){let[t,i]=(0,h.useState)(""),[s,c]=(0,h.useState)(),[d,u]=(0,h.useState)(),[r]=(0,h.useState)(new y(i,o,c,u)),M=()=>{r.start(e),r.flush(),u(void 0)};return(0,h.useEffect)(()=>{e!==void 0&&(r.flush(),r.start(e),r.draw())},[e]),{field:t,game:r,score:s,message:d,restart:M}}var W=require("react/jsx-runtime");function H(){return(0,W.jsx)(V,{})}0&&(module.exports={});
